---
title: "Project 2"
output: html_document
author: "Matthew Coudert"
---
github: https://github.com/mcoudert2000/MT5763_2_180018876

## Introduction
A trial was undertaken for a new hairgrowth drug LUXURIANT® was undertaken to measure its effectiveness both versus existing treatments BaldBeGone and Skinheadnomore and against a placebo treatment. The authors of the study want to know from the data they collected:

* Is LUXURIANT® more effective than a placebo treatment?
* Is LUXURIANT® more effective than BaldBeGone or Skinheadnomore?
* Does age have an effect on the effectiveness of hairgrowth drugs?

In order to answer these questions, first we must take the data provided and tidy it into a format more amenable to our analysis tools. 

## Importing Data into SAS
```
PROC IMPORT OUT= PROJECT2.Baldy 
            DATAFILE= "C:\Users\mjc34\Desktop\Baldy.csv" 
            DBMS=CSV REPLACE;
     GETNAMES=YES;
     DATAROW=2; 
RUN;
```
## Data Wrangling
We want the dataset to be the following tidy format, Row 1: Test Group, Row 2: Hair Length, Row 3: Age

First we will create a dataset for each of the 4 groups and rename for consistency:
```
DATA PROJECT2.Luxuriant;
SET PROJECT2.Baldy;
KEEP Luxuriant AgeLuxuriant;
RENAME Luxuriant = Length AgeLuxuriant = Age;
RUN;

DATA PROJECT2.Luxuriant;
SET PROJECT2.Luxuriant;
Group = 'Luxuriant';
RUN;

DATA PROJECT2.Placebo;
SET PROJECT2.Baldy;
KEEP Placebo AgePlacebo;
RENAME Placebo = Length AgePlacebo = Age;
RUN;

DATA PROJECT2.Placebo;
SET PROJECT2.Placebo;
Group = "Placebo";
RUN;

DATA PROJECT2.BaldBeGone;
SET PROJECT2.Baldy;
KEEP BaldBeGone AgeBaldBeGone;
RENAME BaldBeGone = Length AgeBaldBeGone = Age;
RUN;

DATA PROJECT2.BaldBeGone; 
SET PROJECT2.BaldBeGone;
Group = "BaldBeGone";
RUN;

DATA PROJECT2.SkinHeadNoMore;
SET PROJECT2.Baldy;
KEEP Skinheadnomore AgeSkinheadnomore;
RENAME Skinheadnomore = Length AgeSkinheadnomore = Age;
RUN;

DATA PROJECT2.SkinHeadNoMore;
SET PROJECT2.SkinHeadNoMore;
Group = "SkinHeadNoMore";
RUN;
```

Stacking all the datasets on top of eachother
```
DATA PROJECT2.BigBaldy;
SET PROJECT2.SkinHeadNoMore PROJECT2.Luxuriant PROJECT2.Placebo PROJECT2.BaldBeGone;
RUN;
```
Converting inches to mm for all lengths
```
DATA PROJECT2.BigBaldy;
SET PROJECT2.BigBaldy;
Length = Length * 25.4;
RUN;
```

## Plotting
Now that all of our data is in tidy format, we will visualize it to see if theres any obvious patterns we can spot within the data before we begin our analysis.

```
proc template;
define statgraph sgdesign;
dynamic _AGE _LENGTH _GROUP;
begingraph / designwidth=828 designheight=480;
   entrytitle halign=center 'Length of Hair as Compared to Age and Group';
   layout lattice / rowdatarange=data columndatarange=data rowgutter=10 columngutter=10;
      layout overlay / yaxisopts=( label=('Length of hair post treatment (mm)'));
         scatterplot x=_AGE y=_LENGTH / group=_GROUP name='Age and Group versus Length of Hair (mm)';
         discretelegend 'Age and Group versus Length of Hair (mm)' / opaque=false border=true halign=right valign=top displayclipped=true across=1 order=rowmajor location=inside;
      endlayout;
   endlayout;
endgraph;
end;
run;

proc sgrender data=PROJECT2.BIGBALDY template=sgdesign;
dynamic _AGE="AGE" _LENGTH="LENGTH" _GROUP="GROUP";
run;
```

```{r big_plot}
knitr::include_graphics("/Users/matthewcoudert/Maths/2020:21/MT5763/Project 2/Full Dataset Plot.png")
```

## Analysis
The first question we will answer is if there is any difference between the mean of the Placebo group's length and the mean length of patients who received Luxuriant.

In order to accomplish this first I will use a Macro from the notes (slightly modified) to perform a random sample difference of means t-test.
```
%macro TwoSampRandTest(NumberOfLoops, DataSet, GroupVariable, GroupOneLabel, GroupTwoLabel, ResponseVariable);
	%do i=1 %to &NumberOfLoops;

	DATA RandomGroup;
	SET &DataSet (keep=&GroupVariable);
	RandomIndex=rand('uniform');   
	run;

	PROC SORT DATA=RandomGroup out=RandomGroup;
	by RandomIndex;
	run;

	data WorkingData;
	merge RandomGroup(keep=&GroupVariable) &DataSet(drop=&GroupVariable);
	run;

	data RandomGroup1;
	set WorkingData;
	where &GroupVariable=&GroupOneLabel;
	data RandomGroup2;
	set WorkingData;
	where &GroupVariable=&GroupTwoLabel;
	run;

	proc means data=RandomGroup1 noprint;
	var &ResponseVariable;
	output out=GroupOneMean mean=mean;
	run;

	proc means data=RandomGroup2 noprint;
	var &ResponseVariable;
	output out=GroupTwoMean mean=mean;
	run;

	data _NULL_;
	set GroupOneMean;
	call symput('GroupOneMean', mean);
	run;

	data _NULL_;
	set GroupTwoMean;
	call symput('GroupTwoMean', mean);
	run;

	data Temp;
	RandomisedMean=&GroupTwoMean-&GroupOneMean;
	run;

	data ResultHolder;
		%if &i=1 %then %do;
			set Temp;
		%end;
		%else %do;
			set ResultHolder Temp;
		%end;
	run;
	%end;
%mend;
```

Here we will create a new table holding only the data from Luxuriant and the Placebo
```
DATA PROJECT2.LuxuriantTest;
SET PROJECT2.Luxuriant PROJECT2.Placebo;
Length = Length * 25.4;
RUN;
```

Now we will run the sampling macro created above to generate 100 random samples assuming that the two means are equal
```
%TwoSampRandTest(NumberOfLoops=100, DataSet=PROJECT2.LuxuriantTest, GroupVariable=Group, GroupOneLabel="Placebo", GroupTwoLabel="Luxuriant", ResponseVariable=Length);
```
And then calculate the means for each of the groups in the sample data (generated by the study)
```
PROC MEANS data =  PROJECT2.LuxuriantTest;
  VAR Length; 
  BY Group;
  OUTPUT OUT=mymeans mean=;
RUN;
```
This results in a mean length of 12.9994956mm for the Luxuriant treatment and a length of 2.4850741mm for the Placebo

We will now compare this to the randomly sampled data to see how out of the norm the sampled data is assuming the two have equal means.

```
data ResultHolderabbrev;
set ResultHolder;
where RandomisedMean >= (12.9994956-2.4850741);/* observeddiff as a numeric value */
run;
```
0 of the 100 generated samples have a difference of mean greater than the sample implying that the Luxuriant treatment is better than no treatment. 

Now we will repeat this analysis for Luxuriant vs the Other drugs on the market. First we will compare it to BaldBeGone:
```
DATA PROJECT2.LuxuriantBaldBeGoneTest;
SET PROJECT2.Luxuriant PROJECT2.BaldBeGone;
Length = Length * 25.4;
RUN;

%TwoSampRandTest(NumberOfLoops=100, DataSet=PROJECT2.BaldBeGoneTest, GroupVariable=Group, GroupOneLabel="BaldBeGone", GroupTwoLabel="Luxuriant", ResponseVariable=Length);

PROC MEANS data =  PROJECT2.LuxuriantBaldBeGoneTest;
  VAR Length; 
  BY Group;
  OUTPUT OUT=mymeans mean=;
RUN;
```
This results in a mean length of 12.9994956mm for the Luxuriant treatment and a length of 36.1521295mm for BaldBeGone.

Now comparing this to the observed difference:
```
data ResultHolderabbrev;
set ResultHolder;
where RandomisedMean >= (36.1521295-12.9994956);
run;
```
Again this generates 0 values that have a greater difference in means between BaldBeGone and Luxuriant implying that BaldBeGone is a better treatment to use than Luxuriant. 

Finally comparing Luxuriant to SkinHeadNoMore:

Generating the random samples
```
DATA PROJECT2.LuxuriantSkinHeadNoMoreTest;
SET PROJECT2.SkinHeadNoMore PROJECT2.Luxuriant;
Length = Length * 25.4;
RUN;

%TwoSampRandTest(NumberOfLoops=100, DataSet=PROJECT2.LuxuriantSkinHeadNoMoreTest, GroupVariable=Group, GroupOneLabel="SkinHeadNoMore", GroupTwoLabel="Luxuriant", ResponseVariable=Length);
```
Finding the sample means:
```
DATA PROJECT2.LuxuriantSkinHeadNoMoreTest;
SET PROJECT2.SkinHeadNoMore PROJECT2.Luxuriant;
Length = Length * 25.4;
RUN;

%TwoSampRandTest(NumberOfLoops=100, DataSet=PROJECT2.LuxuriantSkinHeadNoMoreTest, GroupVariable=Group, GroupOneLabel="SkinHeadNoMore", GroupTwoLabel="Luxuriant", ResponseVariable=Length);
```
This results in a mean length of 18.7400940mm for SkinHeadNoMore and a mean length of 12.9994956mm for the Luxuriant treatment. Comparing the sample means to the randomly generated means.
```
DATA ResultHolderabbrev;
SET ResultHolder;
WHERE RandomisedMean >= (18.7400940-12.9994956); /* 18.7400940-12.9994956 is the difference of means between the 2 datasets
RUN;
```
Yet again 0 of the values randomly generated under H0 are greater than the difference between the sample means again implying SkinHeadNoMore is a better treatment than Luxuriant for hair growth. 
 
### Age
Now we must answer the question if Age has an effect on hair growth post treatment.

In order to accomplish this first I will create a dataset with all of the treatments excluding the placebo. 
```
DATA PROJECT2.AgeTest;
SET PROJECT2.SkinHeadNoMore PROJECT2.Luxuriant PROJECT2.BaldBeGone;
Length = Length * 25.4;
RUN;
```
Now we will generate a linear model of Age vs Hair Length (mm) post treatment. 
```
PROC GLM DATA = PROJECT2.AgeTest;
CLASS aspir;
MODEL length = age;
RUN;
```
This results in the fitted linear model $\text{length(mm)}= 22.93469775 - 0.00610651*\text{age}$ 

```{r ageFitPlot}
knitr::include_graphics("/Users/matthewcoudert/Maths/2020:21/MT5763/Project 2/AgeFitPlot.png")
```
